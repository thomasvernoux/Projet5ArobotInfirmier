# include "generator.h"


int T = 0;
int T_haut = 10;
int T_zero = 200;
int T_bas = 0;

float M = 0.2;

float coeff_aleatoire [20] = {0.94, 0.27, 0.83, 0.81, 0.87, 0.30, 0.74, 0.90, 0.56, 0.92, 0.79, 0.05, 0.94, 0.32, 0.58, 0.06, 0.01, 0.96, 0.38, 0.79};

int index_coeff_aleatoire = 0;

int sig_state = 0;
int time_last_switch = 0;


void gen_callback(){





	if (sig_state == 0){  // on est a l'etat bas
		int time = HAL_GetTick();
		if (time - time_last_switch > T_bas){
			HAL_GPIO_WritePin(GPIOB, LD3_Pin, 1);
			HAL_GPIO_WritePin(GPIOC, GPIO_PIN_8, 1);
			time_last_switch = time;
			sig_state = 1;
		}
	}

	if (sig_state == 1){  // on est a l'etat haut
		int time = HAL_GetTick();
		if (time - time_last_switch > T_haut){
			HAL_GPIO_WritePin(GPIOB, LD3_Pin, 0);
			HAL_GPIO_WritePin(GPIOC, GPIO_PIN_8, 0);

			time_last_switch = time;
			sig_state = 0;

			generer_T_aleatoire();

		}
	}
}


void generer_T_aleatoire(){

	float T_aleatoire_float = T_zero + (0.5 - coeff_aleatoire[index_coeff_aleatoire]) * M * T_zero;
	index_coeff_aleatoire ++;
	if (index_coeff_aleatoire == 19){
		index_coeff_aleatoire = 0;
	}

	T = (int)T_aleatoire_float;
	T_bas = T-T_haut;
}


















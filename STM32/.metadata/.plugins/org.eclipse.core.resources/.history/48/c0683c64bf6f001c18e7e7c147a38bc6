#include "ana.h"
#include"usart.h"
#include <stdlib.h>


int N = 100 ;
int Liste_delais_interupt[100] ;

int i = 0 ;
int moyenne =0 ;

int delais1 = 0;
int delais2 = 0;

int seuil = 20; // seuil en ms


uint8_t alerte;
uint8_t last_alerte;

/*
 * Fonction d'acquisition
 *
 *
 */
void acquisition(){

	delais2 = HAL_GetTick();
	i ++;
	if (i == N){
		i = 0;
	}
	Liste_delais_interupt[i] = delais2 - delais1 ;
	delais1 = delais2;
	moyenner() ;
}

/*
 * Cette fonction sert a moyenner le tableau des delays
 *
 */
void moyenner(){

	int somme = 0;
	for (int j = 0; j <= N-1; j++){
		somme += Liste_delais_interupt[j];
	}
	moyenne = somme/N;
}



void tester_moyenne(){



	if ((HAL_GetTick() > 2000) & (abs(moyenne- seuil) > seuil)){
		alerte = 1;
	}
	else{alerte = 0;}

	if (1){
		HAL_UART_Transmit(&huart4, &alerte, 1, 100);}

	last_alerte = alerte;

}






